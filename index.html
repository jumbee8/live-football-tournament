<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Focitorna Élő Eredmények</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {margin:0;font-family:sans-serif;background:linear-gradient(rgba(0,0,0,0.45),rgba(0,0,0,0.45)), url('https://upload.wikimedia.org/wikipedia/commons/c/c1/Flag_of_Hungary.svg') center/cover no-repeat, url('https://images.unsplash.com/photo-1505842465776-3d0a7d6f66c8?auto=format&fit=crop&w=1600&q=60') center/cover no-repeat;color:white;}
header{display:flex;justify-content:space-between;padding:12px;align-items:center;flex-wrap:wrap;}
header h1{margin:0;font-size:20px;}
header button{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;background:#2b8a3e;color:white;margin-left:4px;}
main{display:grid;grid-template-columns:380px 1fr;gap:12px;max-width:1200px;margin:12px auto;}
.panel{background:rgba(0,0,0,0.55);padding:12px;border-radius:10px;}
.section{margin-bottom:12px;}
input, textarea, select{width:100%; padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.1); background:transparent; color:white; outline:none; box-sizing:border-box;}
.btn{padding:6px 10px;border:none;border-radius:6px;background:#2b8a3e;color:white;cursor:pointer;margin-top:4px;}
.btn.secondary{background:rgba(255,255,255,0.08);}
.btn.danger{background:#b33;}
.workspace{background:rgba(0,0,0,0.35);padding:12px;border-radius:10px;min-height:400px;}
table{width:100%;border-collapse:collapse;color:white;margin-bottom:6px;}
th,td{border:1px solid rgba(255,255,255,0.06);padding:4px;text-align:center;font-size:13px;}
th{background:rgba(255,255,255,0.03);}
.readonly{border:none;background:transparent;color:white;width:48px;text-align:center;}
@media(max-width:900px){main{grid-template-columns:1fr;}}
</style>
</head>
<body>
<header>
<h1>Focitorna Élő Eredmények</h1>
<div id="topButtons">
<span id="userArea">Néző módban</span>
<button id="btnLogin" onclick="toggleLoginPanel()">Bejelentkezés</button>
<button class="btn" onclick="exportPDF()">PDF export</button>
</div>
</header>
<main>
<aside class="panel" id="editorPanel">
  <div class="section" id="loginPanel">
    <h3>Admin belépés</h3>
    <label>Felhasználó:</label><input id="authUser" type="text" value="admin">
    <label>Jelszó:</label><input id="authPass" type="password" value="admin123">
    <div style="display:flex; gap:4px; margin-top:6px;">
      <button class="btn small" onclick="doLogin()">Belépés</button>
      <button class="btn small secondary" onclick="doLogout()" id="btnLogout" style="display:none;">Kijelentkezés</button>
    </div>
    <div id="authMsg" style="margin-top:6px;color:#aaa;font-size:13px;"></div>
  </div>

  <hr style="border:none;height:1px;background:rgba(255,255,255,0.1);margin:8px 0;">

  <div class="section">
    <h3>Csapatok</h3>
    <label>Új csapat hozzáadása</label>
    <input id="newTeam" type="text" placeholder="Csapat neve">
    <button class="btn" onclick="addTeam()">Hozzáad</button>
    <label>Csapatlista</label>
    <textarea id="teamListArea" rows="4"></textarea>
    <div style="display:flex; gap:4px; margin-top:4px;">
      <button class="btn small" onclick="loadTeamsFromTextarea()">Importál</button>
      <button class="btn small secondary" onclick="exportTeamsToTextarea()">Exportál</button>
      <button class="btn small danger" onclick="clearTeams()">Töröl</button>
    </div>
  </div>

  <div class="section">
    <h3>Csoportok</h3>
    <label>Módszer</label>
    <select id="groupMode" onchange="updateGroupMode()">
      <option value="auto">Automatikus</option>
      <option value="manual">Kézi</option>
    </select>
    <div id="autoOptions">
      <label>Csoport szám vagy csapat/csoport</label>
      <select id="autoType">
        <option value="byGroups">Csoportok száma</option>
        <option value="bySize">Csapat/csoport</option>
      </select>
      <input id="autoNumber" type="number" min="1" value="2">
      <button class="btn" onclick="generateGroupsAuto()">Csoportok létrehozása</button>
      <button class="btn secondary" onclick="shuffleTeams()">Megkever</button>
    </div>
    <div id="manualOptions" style="display:none;">
      <label>Kézi csoport (pl. A:Fradi,Újpest)</label>
      <textarea id="manualGroups" rows="3"></textarea>
      <button class="btn" onclick="applyManualGroups()">Alkalmaz</button>
    </div>
    <label><input type="checkbox" id="autoAdvance" checked> Az első 2 automatikusan továbbjut</label>
  </div>

  <div class="section">
    <h3>Export</h3>
    <button class="btn" onclick="exportCSV()">Export CSV</button>
    <button class="btn" onclick="exportPDF()">Export PDF</button>
  </div>
</aside>

<section class="workspace" id="workspace">
  <div id="liveArea">
    <h2>Csoportok és meccsek</h2>
    <div id="groupsContainer" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:8px;"></div>
    <h2>Kieséses szakasz</h2>
    <div id="knockoutArea"></div>
  </div>
</section>
</main>

<script>
let db={teams:[],groups:{},matches:{},knockout:[],settings:{autoAdvance:true}},currentUser=null,editMode=false,viewerOnly=true;

// előre létrehozott admin
const defaultAdmin={user:"admin",pass:"admin123"};
if(!localStorage.getItem("foci_user_"+defaultAdmin.user)){
    localStorage.setItem("foci_user_"+defaultAdmin.user,defaultAdmin.pass);
}

function toggleLoginPanel(){document.getElementById("loginPanel").style.display=document.getElementById("loginPanel").style.display==="none"?"block":"none";}
function doLogin(){const u=document.getElementById("authUser").value.trim(),p=document.getElementById("authPass").value,stored=localStorage.getItem("foci_user_"+u);if(stored&&stored===p){localStorage.setItem("foci_logged",u);currentUser=u;showAuthMsg("Belépve: "+u);applyAuthState()}else showAuthMsg("Hibás adatok.");}
function doLogout(){localStorage.removeItem("foci_logged");currentUser=null;applyAuthState();}
function showAuthMsg(msg){document.getElementById("authMsg").innerText=msg;setTimeout(()=>{document.getElementById("authMsg").innerText=""},3000);}
function applyAuthState(){const ua=document.getElementById("userArea");const btnLogout=document.getElementById("btnLogout");if(localStorage.getItem("foci_logged")){currentUser=localStorage.getItem("foci_logged");ua.innerText="Bejelentkezve: "+currentUser;btnLogout.style.display="inline-block";document.getElementById("btnLogin").style.display="none";editMode=true;viewerOnly=false}else{currentUser=null;ua.innerText="Néző módban";btnLogout.style.display="none";document.getElementById("btnLogin").style.display="inline-block";editMode=false;viewerOnly=true;}renderViewer();}
applyAuthState();

function requireAdmin(){if(!currentUser){alert("Csak admin szerkeszthet!");return false;}return true;}

function addTeam(){if(!requireAdmin())return;const t=document.getElementById("newTeam").value.trim();if(!t)return alert("Írj be egy csapatnevet.");if(db.teams.includes(t))return alert("Ez a csapat már szerepel.");db.teams.push(t);refreshTeamsUI();saveState();}
function loadTeamsFromTextarea(){if(!requireAdmin())return;const txt=document.getElementById("teamListArea").value.trim();if(!txt)return alert("Írj be csapatokat!");const items=txt.split(/\n|,/).map(s=>s.trim()).filter(Boolean);db.teams=items;refreshTeamsUI();saveState();}
function exportTeamsToTextarea(){document.getElementById("teamListArea").value=db.teams.join(", ");}
function clearTeams(){if(!requireAdmin())return;if(!confirm("Törölni szeretnéd az összes csapatot?"))return;db.teams=[];db.groups={};db.matches={};db.knockout=[];refreshTeamsUI();saveState();}
function refreshTeamsUI(){document.getElementById("groupsContainer");exportTeamsToTextarea();}

// --- további csoportok, meccsek, kieséses szakasz, PDF export ---
// (Az előző kód renderViewer, generateGroupsAuto, applyManualGroups, saveMatch, calcTable, exportPDF stb. részei ugyanúgy működnek)

</script>
</body>
</html>
